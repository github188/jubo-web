---
layout: docs
title: 体系结构
next_section: iot-connector 
permalink: /docs/iot-architecture/
---

jubo-iot是JuBo IoT系统中的中枢，负责收集和分发所有设备的消息，并与客户端和云端进行通信。

## 通信机制
jubo-iot对外通信可以分为与设备通信、客户端通信和云端通信三种。
每一种使用的协议和实现的功能都有所不同。

### 与设备通信
与设备的通信协议可以分为两类，一类是数目众多的各个设备平台厂商定义的通信协议，另一个就是JuBo自定义的通信协议。

* 目前物联网处于群雄混战的局面，还没有形成一个统一的通信协议标准，几乎每个设备厂商都有自己的物联网协议。JuBo目前还只支持[Alljoyn](https://allseenalliance.org/)协议，如果需要支持其他物联网协议，那么需要添加对应协议的[连接器](/docs/iot-connector)和对应[设备驱动](/docs/iot-driver)。

* JuBo自定义的物联网协议使用[DDP](https://www.meteor.com/ddp#!)协议，DDP(Distributed Data Protocol)是一个客户端和服务端之间的协议，支持两种操作:
	- 客户端向服务端发起远程过程调用 
	- 客户端订阅数据，当数据变化时，服务器向客户端发起通知。

### 与客户端通信
由于JuBo是Web APP平台，因此客户端就是浏览器，通信协议就是HTTP协议。

### 与云端通信
目前只支持DDP协议，后续会支持REST, XMPP, MQTT和TR-069等协议。
在云端使用Meteor框架和DDP协议的前提下，JuBo支持用户数据加密后存储在云端，更好的保护用户数据安全和隐私。

## 运行机制
jubo-iot在启动运行时会加载三个模块:数据中心、消息中心、连接器和设备驱动。

* 数据中心负责所有数据的存储和变化通告，如存储设备的属性，当设备的属性改变时进行通告。
* 消息中心负责消息的收集和分发
* 连接器负责设备的发现和接入，每个连接器对应一种物联网协议。
* 设备驱动负责驱动控制设备，每个设备驱动对应一个或者一类设备。

在jubo-iot启动时会加载所有支持的连接器，并注册所有设备驱动到对应的连接器。当某个设备使用某种物联网协议接入时，对应的连接器会响应并获取设备信息。

根据获取到的设备信息，jubo-iot会查找能够驱动该设备的驱动程序，如果找到匹配的驱动程序，就会把设备信息和属性存入数据中心、发布设备支持的方法，并在消息中心注册设备消息处理函数。

当设备完成接入之后，用户就可以通过手机、平板来查看设备信息和控制设备了。
不过此时设备还没有加入家庭群落，还不能和其他设备交互，只有当用户设置了交互规则(如当温度高于26度时打开空调)之后，设备才真正加入了家庭群落，开始进化之旅。


